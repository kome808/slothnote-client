---
description: 批次處理所有待處理的連結，爬取內容、產生摘要與分類、搜尋關聯筆記、寫入結構化 .md 檔案
---

# 整理筆記 — 自然語言批次處理流程

你是一個知識管理 AI 助理，任務是處理使用者透過 LINE 收集的文章連結。
請用親切的繁體中文進行所有分析與摘要。

// turbo-all

## 觸發語句

當使用者輸入下列任一句，直接啟動本流程（不要求 slash 指令）：

- 整理筆記
- 幫我整理今天的連結
- 開始整理待處理連結

## 步驟

### 1. 拉取待處理連結
```
node scripts/pull-pending.js
```
這會從 Cloudflare Worker / D1 拉取待處理連結到 `notes/_pending.json`。

### 2. 讀取待處理清單

讀取 `notes/_pending.json` 檔案，取得所有待處理的連結列表。
如果清單為空，回報「沒有待處理的連結」並結束。

### 3. 逐一處理每個連結

對每個連結執行以下步驟：

#### 3a. 爬取網頁內容
使用 `read_url_content` 工具爬取連結的網頁內容。

如果爬取失敗，在筆記中標註「⚠️ 無法自動擷取內容」，僅記錄連結本身。

#### 3b. 分析與摘要
根據爬取的內容，產生以下分析：

- **標題**：文章的標題
- **一句話摘要**：30 字以內的核心重點
- **3 個關鍵重點**：用 bullet points 列出
- **作者核心觀點**：2-3 句描述
- **主題分類**：依本篇內容動態命名分類（中文），若與既有分類接近就沿用既有分類
- **關鍵字標籤**：3-5 個關鍵字
- **重要性**：1-3 星（⭐~⭐⭐⭐）

#### 3c. 搜尋關聯筆記
使用 `grep_search` 搜尋 `notes/` 目錄中與本篇文章相關的已有筆記。
搜尋關鍵字包含：主題分類、關鍵字標籤中的詞彙。

如果找到相關筆記，產生一段「AI 洞察」，描述新舊文章之間的關聯。

#### 3d. 寫入筆記檔案
使用以下格式寫入 `notes/{category}/YYYY-MM-DD-{slug}.md`：

（確保分類子目錄存在，必要時建立）

```markdown
---
title: "文章標題"
url: "原始連結"
source: "來源平台"
date: YYYY-MM-DD
category: "分類"
tags: ["標籤1", "標籤2", "標籤3"]
importance: 1-3
status: "unread"
notion_synced: false
---

## 一句話摘要
...

## 關鍵重點
1. ...
2. ...
3. ...

## 原文核心觀點
...

## AI 洞察
> 與之前筆記的關聯分析...

## 延伸討論
（待後續 /extend-discussion 填入）
```

### 4. 更新分類索引
更新 `notes/_index.md`，列出所有分類及其包含的筆記數量。

### 5. 自動重分類（既有資料）
```
node scripts/auto-categorize.js
```
這會依內容自動調整分類，必要時移動既有筆記到更適合的分類資料夾。

### 6. 標記已完成
```
node scripts/mark-done.js
```
這會將 Cloudflare Worker / D1 中已處理的連結標記為完成。

### 7. 同步 Notion（含分類頁刷新）
```
npm run notion:sync
```
若本機 `NOTION_TOKEN/NOTION_DATABASE_ID` 未填，會自動透過 Worker + LINE 綁定資訊取得，不需手動輸入 token。
同步後會自動刷新 `懶人筆記 > 文章分類 > 各分類 > 文章列表`。

### 8. 回報結果
列出本次處理的所有連結處理結果摘要。
