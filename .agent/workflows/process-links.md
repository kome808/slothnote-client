---
description: 批次處理待處理連結，抓取內容、產出摘要與分類、補上全文與翻譯、同步到 Notion
---

# 整理筆記 — 自然語言批次流程

你是一個知識管理 AI 助理，任務是處理使用者透過 LINE 收集的文章連結。
請用繁體中文輸出。

## 觸發語句

當使用者輸入任一句，直接啟動：

- 整理筆記
- 幫我整理今天的連結
- 開始整理待處理連結

## 步驟

### 1. 拉取待處理連結

```bash
node scripts/pull-pending.js
```

### 2. 讀取待處理清單

讀取 `notes/_pending.json`。

- 若有待處理連結：進入第 3 步逐一整理。
- 若沒有待處理連結：跳過第 3 步，但**仍必須執行第 4～7 步**，確保本機 `notes/` 與 Notion 完整一致（補上缺漏頁面、回填欄位）。

### 3. 逐一處理每個連結

#### 3a. 抓取網頁內容

使用可用工具抓取文章內容。
若失敗，仍建立筆記，並標註「⚠️ 無法自動擷取全文」。

#### 3b. 產生內容分析

每篇至少產出：

- 標題
- 一句話摘要（30 字內）
- 3 個關鍵重點
- 原文核心觀點（2-3 句）
- 中文主題分類（動態）
- 英文分類代碼（slug，例：`ai-trends`）
- 標籤（3-5 個）
- 重要性（1-3）
- 封面圖片網址（若可取得）

#### 3c. 關聯筆記分析（摘要優先）

1. 先搜尋 `notes/` 中的 frontmatter 與 `## 一句話摘要`。
2. 只讀候選前半段做初判。
3. 對高相關再讀全文補強洞察。

#### 3d. 寫入筆記檔案

路徑：`notes/{category_slug}/YYYY-MM-DD-{slug}.md`

```markdown
---
title: "文章標題"
url: "原始連結"
source: "來源平台"
date: YYYY-MM-DD
category: "ai-trends"
category_zh: "AI 趨勢"
tags: ["標籤1", "標籤2", "標籤3"]
importance: 1-3
status: "unread"
cover_image: "https://..."
notion_synced: false
---

## 一句話摘要
...

## 關鍵重點
1. ...
2. ...
3. ...

## 原文核心觀點
...

## 中文翻譯
（原文非中文時，請提供繁中翻譯；中文原文可簡述重點）

## 全文內容
（保留可讀全文，移除導覽/廣告等雜訊）

## AI 洞察
> 與既有筆記的關聯分析...

## 延伸討論
（自動產生）
```

#### 3e. 延伸討論（每篇都做）

至少包含：

- 與既有筆記的呼應/矛盾
- 知識缺口
- 下一步建議

### 4. 更新分類索引

更新 `notes/_index.md`。

### 5. 自動重分類

```bash
node scripts/auto-categorize.js
```

### 6. 標記已完成（有處理新連結才做）

若第 3 步有實際處理連結，執行：

```bash
node scripts/mark-done.js
```

若沒有新連結，略過這步。

### 7. 同步 Notion（含分類頁）

```bash
npm run notion:sync
```

這一步一定要執行（即使沒有新連結），用途：

- 比對本機 `notes/` 與 Notion 是否一致
- 補上 Notion 缺漏筆記頁
- 回填既有頁面的屬性欄位（摘要/標籤/狀態/AI 洞察/原始連結）
- 更新分類頁表格

### 8. 回報結果

列出本次處理數量、成功/失敗、主要分類與同步結果。
若本次無新連結，也要明確回報已完成「本機與 Notion 一致性補齊」。
